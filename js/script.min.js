const circle=document.querySelector(".progress-ring__circle-line"),radius=circle.r.baseVal.value,circumference=2*Math.PI*radius;let offset;function setProgress(t){offset=localStorage.getItem("percent")?circumference-localStorage.getItem("percent")/100*circumference:circumference-t/100*circumference,circle.style.strokeDashoffset=offset,localStorage.setItem("percent",t)}circle.style.strokeDasharray=`${circumference} ${circumference}`,circle.style.strokeDashoffset=circumference;const settingsPage=document.querySelector(".page__settings"),startBtn=document.querySelector(".start"),pauseBtn=document.querySelector(".pause"),restartBtn=document.querySelector(".restart"),bell=document.querySelector("audio"),timer=document.getElementById("timer"),focusTimeInput=document.querySelector("#focusTime"),shortBreakInput=document.querySelector("#shortBreak"),longBreakInput=document.querySelector("#longBreak"),submitForm=document.querySelector("form"),buttonControl=document.querySelectorAll(".control__block"),root=document.documentElement,fontItem=document.querySelectorAll(".fonts__item"),fontBlock=document.querySelector(".setting__fonts"),colorItem=document.querySelectorAll(".color__item"),colorBlock=document.querySelector(".setting__color"),colorIcons=document.querySelectorAll(".color-icon"),circleBody=document.querySelector(".progress-ring__circle"),mediaQuery=window.matchMedia("(max-width: 450px)");let seconds,timeout,totalsecs,paused,perc;const changeValueDown=t=>{let e=t.target.closest(".block-control__input").querySelector(".block-control__input-form"),o=parseInt(e.value),c=parseInt(e.min),r=o-parseInt(e.step);e.value=r>=c?r:c},changeValueUp=t=>{let e=t.target.closest(".block-control__input").querySelector(".block-control__input-form"),o=parseInt(e.value),c=parseInt(e.max),r=o+parseInt(e.step);e.value=r<=c?r:c},downButton=document.querySelectorAll(".down");downButton.forEach((t=>{t.addEventListener("click",changeValueDown)}));const upButton=document.querySelectorAll(".up");function timeSection(t){t.target.closest(".settings__close")&&settingsPage.classList.remove("_active"),t.target.closest(".timer__icon")?settingsPage.classList.toggle("_active"):t.target.closest(".settings__apply-btn")&&(settingsPage.classList.remove("_active"),clickOnActive(),changeClasses(),document.title="Pomodoro timer",saveSelectedFont(),saveSelectedColor(),saveSelectedTab(),clearTimeout(timeout),localStorage.removeItem("percent"),setProgress(0),getNewData())}upButton.forEach((t=>{t.addEventListener("click",changeValueUp)})),submitForm.addEventListener("submit",(function(t){t.preventDefault(),localStorage.setItem("items",JSON.stringify(TIMER)),saveInputVal(),TIMER=makeUser(`${focusTimeInput.value}`,`${shortBreakInput.value}`,`${longBreakInput.value}`),innerClock(),setTimer()})),document.addEventListener("click",timeSection);const modeButtons=document.querySelector("[class=control]");function changeInputVal(){localStorage.getItem("focusVal")&&(focusTimeInput.value=JSON.parse(localStorage.getItem("focusVal")),shortBreakInput.value=JSON.parse(localStorage.getItem("shortVal")),longBreakInput.value=JSON.parse(localStorage.getItem("longVal")))}modeButtons.addEventListener("click",changeMode),changeInputVal();var TIMER=JSON.parse(localStorage.getItem("items"))?JSON.parse(localStorage.getItem("items")):makeUser(`${focusTimeInput.value}`,`${shortBreakInput.value}`,`${longBreakInput.value}`);function makeUser(t,e,o){return{POMODORO:t,SHORTBREAK:e,LONGBREAK:o}}function changeMode(t){changeButtonText(),localStorage.removeItem("count_timer"),changeClasses(),clickOnActive(),document.title="Pomodoro timer",clearTimeoutFunc(),saveSelectedTab();let e=t.target.dataset.mode;timer.dataset.mode=e,setProgress(0),setTimer(),innerClock()}function innerClock(){localStorage.getItem("count_timer")?timer.innerHTML=("0"+Math.floor(localStorage.getItem("count_timer")/60)).slice(-2)+":"+("0"+localStorage.getItem("count_timer")%60).slice(-2):localStorage.getItem("modeTab")?"pomodoro"===JSON.parse(localStorage.getItem("modeTab"))?TIMER.POMODORO<10?timer.innerHTML=`0${TIMER.POMODORO}:00`:timer.innerHTML=`${TIMER.POMODORO}:00`:"short"===JSON.parse(localStorage.getItem("modeTab"))?timer.innerHTML=`0${TIMER.SHORTBREAK}:00`:"long"===JSON.parse(localStorage.getItem("modeTab"))&&(TIMER.LONGBREAK<10?timer.innerHTML=`0${TIMER.LONGBREAK}:00`:timer.innerHTML=`${TIMER.LONGBREAK}:00`):"pomodoro"===timer.dataset.mode?TIMER.POMODORO<10?timer.innerHTML=`0${TIMER.POMODORO}:00`:timer.innerHTML=`${TIMER.POMODORO}:00`:"short"===timer.dataset.mode?timer.innerHTML=`0${TIMER.SHORTBREAK}:00`:TIMER.LONGBREAK<10?timer.innerHTML=`0${TIMER.LONGBREAK}:00`:timer.innerHTML=`${TIMER.LONGBREAK}:00`}localStorage.getItem("timer-inner")?timer.innerHTML=localStorage.getItem("timer-inner"):(localStorage.setItem("timer-inner",timer.innerHTML),innerClock());let storedTab=localStorage.getItem("selectedTab")||"[]",tabIndex=JSON.parse(storedTab);for(const t of tabIndex)buttonControl[t].classList.add("_active");buttonControl.forEach((function(t){t.addEventListener("click",(function(){buttonControl.forEach((function(t){t.classList.remove("_active")})),t.classList.add("_active");const e=[];for(let t=0;t<buttonControl.length;t++)buttonControl[t].classList.contains("_active")&&e.push(t)}))}));let stored=localStorage.getItem("selected")||"[]",indexes=JSON.parse(stored);for(const t of indexes)fontItem[t].classList.add("_active");fontItem.forEach((function(t){t.addEventListener("click",(function(){fontItem.forEach((function(t){t.classList.remove("_active")})),t.classList.add("_active");const e=[];for(let t=0;t<fontItem.length;t++)fontItem[t].classList.contains("_active")&&e.push(t)}))}));let storedColor=localStorage.getItem("selectedColor")||"[]",indexesColor=JSON.parse(storedColor);for(const t of indexesColor)colorIcons[t].classList.add("_icon-check-btn");function setTimer(){"pomodoro"===timer.dataset.mode?(count_timer=60*TIMER.POMODORO,totalsecs=60*TIMER.POMODORO):"short"===timer.dataset.mode?(count_timer=60*TIMER.SHORTBREAK,totalsecs=60*TIMER.SHORTBREAK):"long"===timer.dataset.mode&&(count_timer=60*TIMER.LONGBREAK,totalsecs=60*TIMER.LONGBREAK)}function chooseTime(){localStorage.getItem("count_timer")?(count_timer=localStorage.getItem("count_timer"),totalsecs=localStorage.getItem("totalsecs")):setTimer()}function countDownTimer(){var t=("0"+Math.floor(count_timer/60)).slice(-2)+":"+("0"+count_timer%60).slice(-2);timer.innerHTML=t,document.title=`${t} - ${"pomodoro"===timer.dataset.mode?"Work":"Break"}`,count_timer<=0?(localStorage.clear("count_timer"),bell.play(),count_timer=0,pauseBtn.classList.remove("_active"),restartBtn.classList.add("_active")):(count_timer-=1,perc=Math.ceil((totalsecs-count_timer)/totalsecs*100),mediaQuery.matches?setProgress(.77*perc):setProgress(perc),t=("0"+Math.floor(count_timer/60)).slice(-2)+":"+("0"+count_timer%60).slice(-2),localStorage.setItem("count_timer",count_timer),localStorage.setItem("totalsecs",totalsecs),timeoutFunc()),startBtn.classList.contains("_active")&&(startBtn.classList.remove("_active"),pauseBtn.classList.add("_active"))}function timeoutFunc(){timeout=setTimeout(countDownTimer,1e3),paused=!1}function clearTimeoutFunc(){clearTimeout(timeout)}function clickOnActive(){for(i=0;i<buttonControl.length;i++)buttonControl[i].classList.contains("_active")&&buttonControl[i].click()}function changeClasses(){if(!startBtn.classList.contains("_active")){const t=document.querySelectorAll(".button");for(const e of t)e.classList.remove("_active");startBtn.classList.add("_active")}}function pomodoroPause(){void 0!==paused&&(paused?(paused=!1,timeoutFunc(),pauseBtn.textContent="PAUSE"):(clearTimeoutFunc(),pauseBtn.textContent="start",paused=!0))}function pomodoroRestart(){paused=!1,clearTimeoutFunc(),setProgress(0),localStorage.clear(),clickOnActive(),restartBtn.classList.contains("_active")&&(restartBtn.classList.remove("_active"),startBtn.classList.add("_active"))}function saveSelectedTab(){const t=[];for(let o=0;o<buttonControl.length;o++)if(buttonControl[o].classList.contains("_active")){t.push(o);var e=buttonControl[o].dataset.mode}localStorage.setItem("selectedTab",JSON.stringify(t)),localStorage.setItem("modeTab",JSON.stringify(e))}function saveInputVal(){localStorage.setItem("focusVal",focusTimeInput.value),localStorage.setItem("shortVal",shortBreakInput.value),localStorage.setItem("longVal",longBreakInput.value)}function saveSelectedFont(){const t=[];for(let e=0;e<fontItem.length;e++)fontItem[e].classList.contains("_active")&&t.push(e);localStorage.setItem("selected",JSON.stringify(t))}function saveSelectedColor(){const t=[];for(let e=0;e<colorIcons.length;e++)colorIcons[e].classList.contains("_icon-check-btn")&&t.push(e);localStorage.setItem("selectedColor",JSON.stringify(t))}function getNewData(){if(saveInputVal(),null===localStorage.getItem("fontColor"))localStorage.setItem("fontColor",JSON.stringify("#F87070"));else{const t=JSON.parse(localStorage.getItem("fontColor"));root.style.setProperty("--mainColor",`${t}`)}if(null===localStorage.getItem("fontFamily"))localStorage.setItem("fontFamily",JSON.stringify("KumbhSans"));else{const t=JSON.parse(localStorage.getItem("fontFamily"));document.body.style.fontFamily=t}null===localStorage.getItem("selectedTab")&&buttonControl[0].click(),null===localStorage.getItem("selected")&&fontItem[0].click(),null===localStorage.getItem("selectedColor")&&(colorItem[0].click(),colorIcons[0].click()),JSON.parse(localStorage.getItem("items"))}function handleTabletChange(){mediaQuery.matches?(circleBody.setAttribute("r","130"),circleBody.setAttribute("cx","145"),circleBody.setAttribute("cy","145"),setProgress(.77*perc),circle.setAttribute("r","115"),circle.setAttribute("cx","145"),circle.setAttribute("cy","145")):(circleBody.setAttribute("r","170"),circleBody.setAttribute("cx","190"),circleBody.setAttribute("cy","190"),setProgress(perc),circle.setAttribute("r","150"),circle.setAttribute("cx","190"),circle.setAttribute("cy","190"))}function changeButtonText(){count_timer<setTimer?(timeoutFunc(),startBtn.textContent="PAUSE"):(clickOnActive(),startBtn.textContent="START")}colorItem.forEach((function(t){t.addEventListener("click",(function(){colorIcons.forEach((t=>{t.addEventListener("click",(function(){colorIcons.forEach((function(t){t.classList.remove("_icon-check-btn")})),t.classList.add("_icon-check-btn");const e=[];for(let t=0;t<colorIcons.length;t++)colorIcons[t].classList.contains("_icon-check-btn")&&e.push(t)}))}))}))})),getNewData(),chooseTime(),startBtn.addEventListener("click",(()=>{timeoutFunc()})),pauseBtn.addEventListener("click",(()=>{pomodoroPause()})),restartBtn.addEventListener("click",(()=>{pomodoroRestart()})),fontBlock.addEventListener("click",(function(t){t.target.closest("[data-family=KumbhSans]")?localStorage.setItem("fontFamily",JSON.stringify("KumbhSans")):t.target.closest("[data-family=RobotoSlab]")?localStorage.setItem("fontFamily",JSON.stringify("RobotoSlab")):t.target.closest("[data-family=SpaceMono]")&&localStorage.setItem("fontFamily",JSON.stringify("SpaceMono"))})),colorBlock.addEventListener("click",(function(t){t.target.closest("[data-color=pink]")?localStorage.setItem("fontColor",JSON.stringify("#F87070")):t.target.closest("[data-color=blue]")?localStorage.setItem("fontColor",JSON.stringify("#70F3F8")):t.target.closest("[data-color=purple]")&&localStorage.setItem("fontColor",JSON.stringify("#D881F8"))})),window.addEventListener("resize",handleTabletChange,!0),handleTabletChange(),changeButtonText(),count_timer===setTimer&&clickOnActive();